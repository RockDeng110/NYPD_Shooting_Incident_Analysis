---
title: "NPYD_Shooting_Incident"
author: "RockDeng"
date: "2024-01-04"
output:
  html_document: default
  pdf_document: default
---


```{r include = FALSE}
# Load libraries
library(tidyverse)

```
### 1. Import data and get some basic understanding of the data.

Use R to import and take a glimpse of the raw data.
```{r import_files}
# Import files
df <- read_csv("NYPD_Shooting_Incident_Data__Historic_.csv")
glimpse(df)

```

As we can see the output from the above code. This data set has 27312 shooting incidents in total and 21 columns. Next, let's check out the meaning of each column or variable.

Column | Description 
-------|----------
INCIDENT_KEY | Randomly generated persistent ID for each arrest	
OCCUR_DATE   | Exact date of the shooting incident	
OCCUR_TIME   | Exact time of the shooting incident   
BORO         | Borough where the shooting incident occurred        
LOC_OF_OCCUR_DESC  | NA  
PRECINCT           | Precinct where the shooting incident occurred 
JURISDICTION_CODE  | Jurisdiction where the shooting incident occurred.  
LOC_CLASSFCTN_DESC | NA 
LOCATION_DESC      | Location of the shooting incident   
STATISTICAL_MURDER_FLAG | Shooting resulted in the victim’s death which would be counted as a murder
PERP_AGE_GROUP     | Perpetrator’s age within a category   
PERP_SEX           | Perpetrator’s sex description  
PERP_RACE          | Perpetrator’s race description 
VIC_AGE_GROUP      | Victim’s age within a category  
VIC_SEX            | Victim’s sex description 
VIC_RACE           | Victim’s race description  
X_COORD_CD         | Midblock X-coordinate for New York State Plane Coordinate System, Long Island Zone, NAD 83, units feet (FIPS 3104)   
Y_COORD_CD         | Midblock Y-coordinate for New York State Plane Coordinate System, Long Island Zone, NAD 83, units feet (FIPS 3104)   
Latitude           | Latitude coordinate for Global Coordinate System, WGS 1984, decimal degrees (EPSG 4326)  
Longitude          | Longitude coordinate for Global Coordinate System, WGS 1984, decimal degrees (EPSG 4326)  
Lon_Lat            | Combination of Latitude and Longtitude


### 2. Tidying and Transforming Data

* First of all, convert the columns to convenient data type

```{r}
glimpse(df)

# Convert OCCUR_DATE from string to date format
df$OCCUR_DATE = as.Date(df$OCCUR_DATE, format = "%m/%d/%Y")

# Convert category columns to factors
unique(df$VIC_AGE_GROUP)
unique(df$VIC_SEX)
unique(df$VIC_RACE)

unique(df$PERP_AGE_GROUP)
unique(df$PERP_SEX)
unique(df$PERP_RACE)
```
```{r}
dim(df)

unique(df$PERP_AGE_GROUP)
df %>%
  filter(PERP_AGE_GROUP %in% c(NA, "UNKNOWN", "(null)")) %>%
  count() ->
  perp_age_na_count

unique(df$PERP_SEX)
df %>%
  filter(PERP_SEX %in% c(NA, "(null)")) %>%
  count() ->
  perp_sex_na_count

unique(df$PERP_RACE)
df %>%
  filter(PERP_RACE %in% c(NA, "UNKNOWN", "(null)")) %>%
  count() ->
  perp_race_na_count

perp_age_na_count
perp_sex_na_count
perp_race_na_count


```
### 3. Exploratory Data Analysis and Visualization


```{r}
# Check out the victims
unique(df$VIC_AGE_GROUP)
df %>%
  filter(VIC_AGE_GROUP != "1022") ->
  df


# Define a function to analyze and visualize a category column.
analyze_category <- function(data, col_name){
    ggplot(data) +
    geom_bar(aes_string(y = col_name, fill = col_name))
}

# Analysis for victims
analyze_category(df, "VIC_AGE_GROUP")
analyze_category(df, "VIC_SEX")
analyze_category(df, "VIC_RACE")

```
```{r}
# Analysis geographically
analyze_category(df, "BORO")
```

```{r}
#glimpse(df)
df %>%
  mutate(year = year(OCCUR_DATE)) %>%
  group_by(year) %>%
  summarize(n = n()) %>%
  ggplot() +
  geom_line(aes(x = year, y = n), color = "blue", size = 3)

df %>%
  group_by(OCCUR_DATE) %>%
  summarize(n = n()) %>%
  ggplot() +
  geom_line(aes(x = OCCUR_DATE, y = n), color = "blue", size = 1)
```


### 4. Modeling

```{r}
unique(df$STATISTICAL_MURDER_FLAG)

# # Define a function to analyze and visualize a category column.
# analyze_category <- function(data, col_name){
#     ggplot(data) +
#     geom_bar(aes_string(y = col_name, fill = "STATISTICAL_MURDER_FLAG"))
# }
# 
# # Analysis for victims
# analyze_category(df, "VIC_AGE_GROUP")
# analyze_category(df, "VIC_SEX")
# analyze_category(df, "VIC_RACE")
# analyze_category(df, "BORO")

lm <- lm(STATISTICAL_MURDER_FLAG ~ VIC_AGE_GROUP + VIC_SEX + VIC_RACE + BORO, data = df)
summary(lm)
```


```{r}
library("modelr")

sim1

grid <- sim1 %>% 
  data_grid(x) 

grid
```
